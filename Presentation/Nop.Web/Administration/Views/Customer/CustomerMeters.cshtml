@model System.Collections.Generic.List<CustomerMetersModel>
    @using System.Globalization;

    @{
        var defaultGridPageSize = EngineContext.Current.Resolve<Nop.Core.Domain.Common.AdminAreaSettings>().DefaultGridPageSize;
        var gridPageSizes = EngineContext.Current.Resolve<Nop.Core.Domain.Common.AdminAreaSettings>().GridPageSizes;

        //page title
        ViewBag.Title = T("Customers").Text;
        //active menu item (system name)
        Html.SetActiveMenuItemSystemName("Customers list");
        var Meterlist = @Model;
    }

    @using (Html.BeginForm(new { id = "__AjaxAntiForgeryForm" }))
    {
        @Html.AntiForgeryToken()
    }
        <div class="content-header clearfix">
            <h1 class="pull-left">
                Meter Details
            </h1>
        </div>
        @*<div class="pull-right">

                    <div class="btn-group">
                        <button type="button" class="btn btn-success">
                            <i class="fa fa-download"></i>
                            @T("Admin.Common.Export")
                        </button>
                        <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                            <span class="caret"></span>
                            <span class="sr-only">&nbsp;</span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li>
                                <button type="submit" name="exportxml-all">
                                    <i class="fa fa-file-code-o"></i>
                                    @T("Admin.Common.ExportToXml.All")
                                </button>
                            </li>
                            <li>
                                <button type="button" id="exportxml-selected">
                                    <i class="fa fa-file-code-o"></i>
                                    @T("Admin.Common.ExportToXml.Selected")
                                </button>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <button type="submit" name="exportexcel-all">
                                    <i class="fa fa-file-excel-o"></i>
                                    @T("Admin.Common.ExportToExcel.All")
                                </button>
                            </li>
                            <li>
                                <button type="button" id="exportexcel-selected">
                                    <i class="fa fa-file-excel-o"></i>
                                    @T("Admin.Common.ExportToExcel.Selected")
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>*@

        @*<div class="content">
            <div class="form-horizontal">
                <div class="panel-group">
                    <div class="panel panel-default panel-search">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <div class="col-md-4">
                                            Payment status
                                        </div>
                                        <div class="col-md-8">
                                            <select style="width:50%">
                                                <option value="Due">Due</option>
                                                <option value="Ok">Ok</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <div class="col-md-4">
                                            Meter Status
                                        </div>
                                        <div class="col-md-8">
                                            <select style="width:50%">
                                                <option value="Due">Active</option>
                                                <option value="Ok">Inavtive</option>
                                            </select>
                                        </div>
                                    </div>

                                </div>


                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <div class="col-md-4">
                                            @Html.NopLabelFor(model => model.SearchEmail)
                                        </div>
                                        <div class="col-md-8">
                                            @Html.NopEditorFor(model => model.SearchEmail)
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <div class="col-md-4">
                                            @Html.NopLabelFor(model => model.SearchUsername)
                                        </div>
                                        <div class="col-md-8">
                                            @Html.NopEditorFor(model => model.SearchUsername)
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-7 col-md-offset-5">
                                    <button type="button" id="search-customers" class="btn btn-primary btn-search">
                                        <i class="fa fa-search"></i>
                                        @T("Admin.Common.Search")
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>*@

                    <div class="panel panel-default">
                        <div class="panel-body">
                          
                            <div id="customers-grid"></div>

                            <script>
                                var arrayOfArrays = JSON.parse('@Html.Raw(Json.Encode(Model))');
                                console.log(arrayOfArrays)
                                $(document).ready(function () {
                                    
                                    
                                    function Activate(DeviceId, Status) {
                                        var data;
                                        data.DeviceId = DeviceId;
                                        data.Status=Status
                                        $.ajax({
                                            url: "Customer/UpdateCustomereProductStatus",
                                            type: 'POST',
                                            data:data,
                                            error: function (xhr, ajaxOptions, thrownError) {
                                                alert(xhr.status);
                                                alert(thrownError);
                                            }
                                        });
                                    }
                                    function Deactivate(DeviceId, Status) {
                                        var data ;
                                        data.DeviceId = DeviceId;
                                        data.Status = Status
                                        $.ajax({
                                            url: "Customer/UpdateCustomereProductStatus",
                                            type: 'POST',
                                            data: data,
                                            error: function (xhr, ajaxOptions, thrownError) {
                                                alert(xhr.status);
                                                alert(thrownError);
                                            }
                                        });
                                    }
                                    $("#customers-grid").kendoGrid({
                                        dataSource: {
                                            data: arrayOfArrays,
                                            schema: {
                                                model: {
                                                    fields: {
                                                        Status: { type: "bool" },
                                                        MeterId: { type: "string" },
                                                        IsBillPaid: { type: "bool" },
                                                        //Status: { type: "string" },
                                                        //Id: { type: "number" },
                                                        //Payment: { type: "string" },
                                                        //Email: { type: "string" },
                                                        CustomerFullName: { type: "string" }
                                                        //UserId: { type: "string" },

                                                    }
                                                }
                                            },
                                            error: function (e) {
                                                display_kendoui_grid_error(e);
                                                // Cancel the changes
                                                this.cancelChanges();
                                            },
                                            serverPaging: true,
                                            serverFiltering: true,
                                            serverSorting: true,
                                            pageSize: 20
                                        },
                                        pageable: {
                                            refresh: true,
                                            pageSizes: 20,
                                        },
                                        scrollable: false,
                                        sortable: true,
                                        filterable: false,
                                        columns: [
                                            {
                                                field: "CustomerFullName",
                                                title: "Customer Name",
                                                template: '#= CustomerFullName #',
                                                attributes: { style: "text-align:center" },
                                                width: 300
                                            },
                                            {
                                                field: "Id",
                                                title: "Device Id",
                                                template: '<a href="CustomerMeterDetails/' + '#= MeterId #' + '">' + '#= MeterId #' + '</a>',
                                                attributes: { style: "text-align:center" },
                                                width: 300
                                            },
                                            
                                            //{
                                            //    field: "Email",
                                            //    title: "Email",
                                            //    template: 'harshit@gmail.com',
                                            //    attributes: { style: "text-align:center" },
                                            //    width: 300
                                            //},
                                            //{
                                            //    field: "UserId",
                                            //    title: "User ID",
                                            //    template: '123456',
                                            //    attributes: { style: "text-align:center" },
                                            //    width: 300
                                            //},
                                            {
                                                field: "IsBillPaid",
                                                title: "Payment",
                                                template: '# if(IsBillPaid) {# <span class="label label-success">Paid</span> #} else {# <span class="label label-danger">Due</span>#} #',
                                                attributes: { style: "text-align:center" },
                                                width: 300
                                            },
                                            {
                                        field: "status",
                                        title: "Status",
                                        template: '# if(Status) {# <span class="label label-success">Active</span> #} else {# <span class="label label-danger">Inactive</span>#} #',
                                        attributes: { style: "text-align:center" },
                                        width: 300
                                    }, 
                                            {
                                                field: "Status",
                                                title: "Change Status",
                                                template: '# if(Status) {# <button class="btn btn-danger deact" id="#= MeterId #" data-status="#= Status #">Deactivate</button> #} else {# <button class="btn btn-success act" id="#= MeterId #" data-status="#= Status #">Activate</button>#} #',
                                                attributes: { style: "text-align:center" },
                                                width: 300
                                            },




                                        ]
                                    });
                                    $(".deact").bind("click", function (e) {
                                        //e.preventDefault()
                                        debugger
                                        var data = {};
                                        data.DeviceId = $(this).attr("id");
                                        data.Status = false;
                                        var token = $('input[name="__RequestVerificationToken"]').val();
                                        debugger
                                        $.ajax({
                                            url: "/Admin/Customer/UpdateCustomereProductStatus",
                                            type: 'POST',
                                            //data: {
                                            //    __RequestVerificationToken: token, 
                                            //    data:data},
                                            data: {
                                                __RequestVerificationToken: token,
                                                DeviceId: data.DeviceId,
                                                Status: data.Status
                                            },
                                            success: function () {
                                                location.reload();
                                            },

                                            error: function (xhr, ajaxOptions, thrownError) {
                                                alert(xhr.status);
                                                alert(thrownError);
                                            }
                                        });
                                        
                                    })
                                    $(".act").bind("click", function (e) {
                                        //e.preventDefault()
                                        debugger
                                        var data = {};
                                        data.DeviceId = $(this).attr("id");
                                        data.Status = true;
                                        var token = $('input[name="__RequestVerificationToken"]').val();
                                        debugger
                                        $.ajax({
                                            url: "/Admin/Customer/UpdateCustomereProductStatus",
                                            type: 'POST',
                                            //data: {
                                            //    __RequestVerificationToken: token, 
                                            //    data:data},
                                            data: {
                                                __RequestVerificationToken: token,
                                                DeviceId: data.DeviceId,
                                                Status: data.Status
                                            },
                                            success: function () {
                                                location.reload();
                                            },

                                            error: function (xhr, ajaxOptions, thrownError) {
                                                alert(xhr.status);
                                                alert(thrownError);
                                            }
                                        });
                                        
                                    })
                                });
                               
                           
                            </script>

                            <script type="text/javascript">
                                var selectedIds = [];

                                $(document).ready(function () {
                                    //search button
                                    $('#search-customers').click(function () {
                                        var grid = $('#customers-grid').data('kendoGrid');
                                        grid.dataSource.page(1); //new search. Set page size to 1
                                        //grid.dataSource.read(); we already loaded the grid above using "page" function
                                        //clear selected checkboxes
                                        $('.checkboxGroups').attr('checked', false).change();
                                        selectedIds = [];
                                        return false;
                                    });

                                    @*$("".concat("#@Html.FieldIdFor(model => model.SearchEmail),",
                                    "#@Html.FieldIdFor(model => model.SearchUsername),",
                                    "#@Html.FieldIdFor(model => model.SearchFirstName),",
                                    "#@Html.FieldIdFor(model => model.SearchLastName),",
                                    "#@Html.FieldIdFor(model => model.SearchCompany),",
                                    "#@Html.FieldIdFor(model => model.SearchPhone),",
                                    "#@Html.FieldIdFor(model => model.SearchZipPostalCode),",
                                    "#@Html.FieldIdFor(model => model.SearchIpAddress)")).keydown(function(event) {
                                        if (event.keyCode === 13) {
                                            $("#search-customers").click();
                                            return false;
                                        }
                                    });*@

                                    $('#mastercheckbox').click(function () {
                                        $('.checkboxGroups').attr('checked', $(this).is(':checked')).change();
                                    });

                                    //wire up checkboxes.
                                    $('#customers-grid').on('change', 'input[type=checkbox][id!=mastercheckbox][class=checkboxGroups]', function (e) {
                                        var $check = $(this);
                                        if ($check.is(":checked") == true) {
                                            var checked = jQuery.inArray($check.val(), selectedIds);
                                            if (checked == -1) {
                                                //add id to selectedIds.
                                                selectedIds.push($check.val());
                                            }
                                        } else {
                                            var checked = jQuery.inArray($check.val(), selectedIds);
                                            if (checked > -1) {
                                                //remove id from selectedIds.
                                                selectedIds = $.grep(selectedIds, function (item, index) {
                                                    return item != $check.val();
                                                });
                                            }
                                        }
                                        updateMasterCheckbox();
                                    });
                                });

                                function onDataBound(e) {
                                    $('#customers-grid input[type=checkbox][id!=mastercheckbox][class=checkboxGroups]').each(function () {
                                        var currentId = $(this).val();
                                        var checked = jQuery.inArray(currentId, selectedIds);
                                        //set checked based on if current checkbox's value is in selectedIds.
                                        $(this).attr('checked', checked > -1);
                                    });

                                    updateMasterCheckbox();
                                }

                                function updateMasterCheckbox() {
                                    var numChkBoxes = $('#customers-grid input[type=checkbox][id!=mastercheckbox][class=checkboxGroups]').length;
                                    var numChkBoxesChecked = $('#customers-grid input[type=checkbox][id!=mastercheckbox][class=checkboxGroups]:checked').length;
                                    $('#mastercheckbox').attr('checked', numChkBoxes == numChkBoxesChecked && numChkBoxes > 0);
                                }

                                @*function additionalData() {
                                var data = {
                                    SearchCustomerRoleIds: $('#@Html.FieldIdFor(model => model.SearchCustomerRoleIds)').val(),
                                    SearchEmail: $('#@Html.FieldIdFor(model => model.SearchEmail)').val(),
                                    SearchUsername: $('#@Html.FieldIdFor(model => model.SearchUsername)').val(),
                                    SearchFirstName: $('#@Html.FieldIdFor(model => model.SearchFirstName)').val(),
                                    SearchLastName: $('#@Html.FieldIdFor(model => model.SearchLastName)').val(),
                                    SearchDayOfBirth: $('#@Html.FieldIdFor(model => model.SearchDayOfBirth)').val(),
                                    SearchMonthOfBirth: $('#@Html.FieldIdFor(model => model.SearchMonthOfBirth)').val(),
                                    SearchCompany: $('#@Html.FieldIdFor(model => model.SearchCompany)').val(),
                                    SearchPhone: $('#@Html.FieldIdFor(model => model.SearchPhone)').val(),
                                    SearchZipPostalCode: $('#@Html.FieldIdFor(model => model.SearchZipPostalCode)').val(),
                                    SearchIpAddress: $('#@Html.FieldIdFor(model => model.SearchIpAddress)').val()
                                };
                                addAntiForgeryToken(data);
                                return data;
                            }*@
                            </script>
                        </div>
                    </div>
                @*</div>

            </div>*@
        @*</div>*@
    

    @*export selected (XML). We don't use GET approach because it's limited to 2K-4K chars and won't work for large number of entities*@
    @using (Html.BeginForm("ExportXmlSelected", "Customer", FormMethod.Post, new { id = "export-xml-selected-form" }))
    {
        @Html.AntiForgeryToken()
        <input type="hidden" id="selectedIds" name="selectedIds" value="" />
    }

    <script type="text/javascript">
        $(document).ready(function () {
            $('#exportxml-selected').click(function (e) {
                e.preventDefault();
                var ids = selectedIds.join(",");
                $('#export-xml-selected-form #selectedIds').val(ids);
                $('#export-xml-selected-form').submit();
                return false;
            });
        });
    </script>

    @*export selected (Excel). We don't use GET approach because it's limited to 2K-4K chars and won't work for large number of entities*@
    @using (Html.BeginForm("ExportExcelSelected", "Customer", FormMethod.Post, new { id = "export-excel-selected-form" }))
    {
        @Html.AntiForgeryToken()
        <input type="hidden" id="selectedIds" name="selectedIds" value="" />
    }
    <script type="text/javascript">
        $(document).ready(function () {
            $('#exportexcel-selected').click(function (e) {
                e.preventDefault();
                var ids = selectedIds.join(",");
                $('#export-excel-selected-form #selectedIds').val(ids);
                $('#export-excel-selected-form').submit();
                return false;
            });
        });
    </script>
